# qcnet
## QCNet对Agent的编码方式

1. **本地时空坐标系统**
   - 为每个代理（agent）的状态在每个时间步建立一个本地时空坐标系统。
   - 所有查询和场景元素的特征都在其本地参考框架内进行处理，使编码独立于全局时空坐标系，保持旋转-平移不变性和时间维度的平移不变性。

2. **场景元素嵌入**
   - 计算代理状态的几何属性的极坐标（如速度、运动向量等），并将这些极坐标转换为傅里叶特征（Fourier features）。
   - 将傅里叶特征与代理的语义属性结合，通过多层感知器（MLP）生成代理状态的嵌入。

3. **相对时空位置嵌入**
   - 计算代理和其他场景元素之间的相对位置嵌入，描述两个元素之间的相对距离、方向、方位和时间差。
   - 将这些相对位置信息整合到注意力机制中，帮助模型考虑代理之间及代理与其他元素之间的相对关系。

4. **分解注意力机制**
   - **时间注意力（Temporal Attention）**: 关注代理在不同时间步之间的关系。
   - **代理-地图注意力（Agent-Map Attention）**: 关注代理与地图元素之间的关系。
   - **社交注意力（Social Attention）**: 关注不同代理之间的交互关系。

5. **缓存与重用**
   - 缓存先前观察窗口中计算的代理编码，在新数据到达时仅更新新增部分，减少在线推理的计算开销。

## QCNet对Map的编码方式

1. **本地时空坐标系统**
   - 为每个地图元素（如车道、交叉路口等）建立一个本地坐标系统，通常基于地图元素的中心线入口点的位置信息和方向。
   - 使编码独立于全局坐标系的变化，确保在全局参考框架的变换下保持不变。

2. **场景元素嵌入**
   - 计算每个地图元素的几何属性（如采样点的位置）的极坐标，并转换为傅里叶特征。
   - 将傅里叶特征与地图元素的语义属性结合，通过多层感知器（MLP）生成地图元素的嵌入。

3. **相对时空位置嵌入**
   - 计算地图元素对之间的相对位置嵌入，描述相对距离、方向、方位和时间差。
   - 在注意力操作中使用这些嵌入，帮助模型理解地图元素之间的空间关系和互动。

4. **自注意力用于地图编码**
   - 使用自注意力（Self-Attention）机制来编码地图元素之间的关系。
   - 为每个地图元素导出一个查询向量，并让它注意相邻的地图元素，结合相对位置嵌入，以引入空间感知。

5. **编码的共享和重用**
   - 地图编码在所有目标代理和时间步之间共享，并在后续的预测过程中重复使用，减少冗余计算，提高效率。
