### 1. 决策方法
1. 决策的难点和痛点
2. 一些常见的决策规划架构
3. 考虑避挡的处理方法
4. 风险场
5. 基于驾驶员模型的交互推演框架
6. 大疆的实例
7. **Prediction-planning** 一体化博弈架构
8. 博弈方法概述与分类
9. 博弈场景举例
10. 潜在切入点

---

### 2. 决策规划难点——不确定性
- **感知的不确定性**：
  1. 目标追踪的不确定性：长时间遮挡后再度出现时的不确定性。
  2. 对目标的感知能力不佳会导致目标位置信息抖动。

- **目标的不确定性**：
  1. 横向意图：目标车道选择、何时变道。
  2. 纵向意图：让速和不让速。

- **目标轨迹的不确定性**：由于预测的偏差，时间越长，预测偏差越大。

---

### 3. 决策规划难点——不确定性（环境因素）
- **环境遮挡带来的不确定性**：例如行人或车辆的遮挡会影响对周围情况的感知。
- **视觉建图时，道路结构带来的不确定性**：实时视觉建图有可能产生偏差，影响规划路线的准确性。

---

### 4. 决策规划难点——不确定性（决策策略）
- 决策策略如何考虑未来某时段的潜在收益？
- 决策时是保持跟车还是选择侵入更快的车道？
- 如何考虑其他车辆的强行加塞风险？
- 如何保证决策的结果是规划能够顺利实现的？

---

### 5. 决策规划的潜在发展方向
- **从单步决策到多步决策**：
  - 逐步进化为多步决策，使得决策更加连贯。
  
- **从串行到闭环架构**：
  - 预测、决策、规划的串行架构向闭环架构演进。

- **从单模态决策到多模态决策**：
  - 多模态决策涵盖更多的可能性，如多种交互与博弈策略。

- **防御性规划**：
  - 采用防御性规划（Contingency Planning）来应对不可预知的情况。

---

### 6. 常见的决策规划架构

1. **架构要点**：
   - 预测、决策、规划、控制架构会随着算力增加逐步升级。
   - 多步骤流程：从粗略选择、再到规划，最终生成具体策略。

2. **先粗略规划，再决策**：
   - MPDM框架用于多次推演，寻找最优决策。

3. **先决策再规划**：
   - 先通过生成决策空间，再进一步规划。

---

### 7. 使用预测规划一体化解决交互问题

1. **交互问题的限制**：
   - 传统分离式的行为预测和规划方法在复杂交互场景下可能会错失机会，如换道时机。
   
2. **博弈化解决交互问题**：
   - 通过将交互问题设定为博弈问题，并通过联合优化来同时处理行为预测和规划。

3. **传统流程 vs PiP（预测与规划耦合架构）**：
   - 传统流程仅基于历史轨迹预测，且与规划解耦。
   - PiP架构将未来的自车规划与历史轨迹相结合，优化了预测与规划的耦合效果。

---

### 8. 决策规划难点的处理方法

1. **避挡区域的不确定性**：
   - 处理避障区域时，需考虑虚拟障碍物及其概率估计。
   - 使用POMDP进行概率更新，以及运用运动学公式进行推算。
   
2. **处理方法1：Ghost object + 防御性规划**：
   - 在避障区域，根据道路属性和交通流速生成虚拟障碍物（ghost object）。
   - 通过ghost object 和 Contingency Planning 来应对潜在风险。

3. **处理方法2：风险势能场（Risk potential field）**：
   - 通过风险场计算车辆在避障区域中的减速需求，根据SLT空间与风险场的交互影响调整车速。

4. **引入碰撞风险表征**：
   - 可行边界、车道边界、舒适性等约束条件，横纵向耦合可同时提供限制信息和空间排斥力。

---

### 9. 多模态决策（Multi-modality）

1. **多种可能性考虑**：
   - 考虑目标意图的多种可能性。
   - 考虑自车决策策略的多种可能性。
   - 考虑冲突目标之间的相互影响。

2. **多模态决策方法**：
   - 基于采样与推演的方式，通过POMDP模型和蒙特卡罗树搜索（MCTS）实现所有动作状态空间的优化（Alpha Go的方法）。
   - 通过对所有状态空间的操作进行采样与推演，找到最优的策略路径。

---

### 10. 多策略推演决策

1. **EUDM框架**：
   - 通过环境感知、模拟推演、策略评估等模块，逐步生成多策略决策的最优路径。
   - 使用DCP-Tree和闭环模拟来预测未来策略的收益。

2. **策略序列计算**：
   - 在多种策略下，计算每个场景下的自车Cost，包括效率、舒适性和与期望车速的偏差。

---

### 11. 实例解析

1. **语义行为选择**：
   - 包括纵向gap选择、横向车道选择和横向行为选择。
   - 通过行为采样生成可能的操作序列，并进行成本评估，最终输出多条可能的动作序列。

2. **多步多模态语义决策架构**：
   - 通过多种场景、成本计算和博弈评估，最终确定自车的决策路径。

---

### 12. 实际案例分析

1. **不同场景下的决策生成**：
   - 考虑多种策略组合，并通过采样和推演来评估每种选择的Cost。
   - 通过博弈树设计决策路径，从多个候选方案中选择最优策略。
  
2. **多步决策路径的生成**：
   - 结合路径、速度和博弈分析生成最终的驾驶轨迹，考虑复杂场景下的多种可能性。

---

### 13. 博弈算法

1. **宏观博弈**：
   - 基于较粗的时间和动作空间，寻找全局最优的控制序列。
   - 采用时间跨度较大的采样，考虑较多的博弈目标。
   - 通过采样搜索方式求解。

2. **微观博弈**：
   - 基于较细的时间和动作空间，寻找精细化的控制序列。
   - 只能在凸空间进行，采样空间较精细。
   - 博弈目标较少，适用于优化算法（如 iLQGame）。

---

### 14. 博弈模型

1. **两种博弈模型**：
   - 合作博弈和非合作博弈。
   - 在自动驾驶决策中，通常研究的是非合作博弈。
   - 使用纳什均衡模型、斯塔克博弈模型等。

2. **应用方向**：
   - Level-k 博弈模型和斯塔克博弈模型（Leader-follower Game）在实际应用中的潜力较大。

---

### 15. 斯塔克博弈的例子

1. **Follower V2 的轨迹预测**：
   - 通过预测 follower V2 的轨迹，评估其与 leader V1 的博弈选择。
   - 模型中通过矩阵方式计算各个选择的收益。

2. **Leader V1 的最优轨迹选择**：
   - 预测 leader V1 的最优轨迹，并结合 follower 的决策进行博弈分析。
   - 两者角色互换后，继续博弈推演，以验证博弈模型的有效性。

---

### 16. Level-K Game 模型

1. **博弈角色的划分**：
   - Level-0：假设不考虑其他 agent 的交互。
   - Level-1：假设其他车辆为 Level-0，并据此决策。
   - Level-2：假设其他车辆为 Level-1，逐步推理。

2. **Level-k 的求解方法**：
   - 采用极限搜索、MCTS 或优化和学习方法来求解博弈策略。

---

### 17. 博弈决策空间

1. **动作空间**：
   - 涵盖纵向加速度、横向转角等。
   - 宏观博弈可以进行较粗采样，微观博弈则可以更精细采样。

2. **语义空间**：
   - 通过语义空间描述可能的决策状态。

3. **轨迹空间**：
   - 在已给定的空间上进行轨迹生成，受到场景的影响。

---

### 18. 驾驶员决策与观察模型

1. **驾驶员决策模型**：
   - 使用 **Boltzmann Rational Policy** 模型来模拟驾驶员的决策过程。

2. **驾驶员观察模型**：
   - 采用 **贝叶斯推断** 和 **高斯分布** 来描述驾驶员的观察行为。

3. **博弈模型目标函数的设计**：
   - 涵盖进度、安全性、舒适性、期望速度、车道保持、控制努力等多个因素。
   - 使用 KL 散度描述礼貌性奖励（courtesy reward），通过差异化计算置信度奖励（confidence reward）。

4. **博弈优化求解方法**：
   - 使用暴力搜索、动态规划、iLQR、MCTS等方法优化博弈策略。

---

### 19. 决策的输出

1. **最优模态输出**：
   - 如果假设目标 agent 只有一个模态可能性，则可以选择该模态作为唯一输出，简化决策和规划过程。
   
2. **多模态输出**：
   - 当目标 agent 可能处于多种模态时，需要同时考虑各个模态及其概率，做出综合决策。
   - 可考虑 leader/follower 角色的不同行为选择，探索并施行多模态下的安全决策。

---

### 20. 潜在的切入点

1. **采用采样博弈方法**：
   - 使用 sampling-based method 或 leader-follower game 进行纵向博弈，尤其在变道和交叉路口时进行预测和轨迹更新。
   
2. **横纵向结合采样**：
   - 通过 MCTS 在博弈模型中进行横纵向联合采样，寻找最优博弈结果。
   - 应用 iLQ-Game 解决凸空间下的决策问题，进行统一求解。

---
